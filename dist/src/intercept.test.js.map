{"version":3,"sources":["../../src/intercept.test.js"],"names":["describe","beforeEach","restore","xmlHttpRequestMocks","open","jest","fn","send","setRequestHeader","global","XMLHttpRequest","it","get","data","fetch","json","response","expect","toEqual","toBeCalledWith","toMatchSnapshot","headers","some","options","method","body","interceptedCalls","post","push","request","length","toBe","url","content","undefined","statusCode","mockImplementation","Error","console","error","mock","calls"],"mappings":"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","file":"intercept.test.js","sourcesContent":["import fetchMock from 'fetch-mock';\nimport interceptFetchCalls from './intercept';\n\ndescribe('intercept', () => {\n  beforeEach(() => {\n    fetchMock.restore();\n\n    const xmlHttpRequestMocks = {\n      open: jest.fn(),\n      send: jest.fn(),\n      setRequestHeader: jest.fn(),\n    };\n\n    global.XMLHttpRequest = () => xmlHttpRequestMocks;\n  });\n\n  it('should intercept a plain url', async () => {\n    fetchMock.get('http://someurl.com', { data: 'abc123' });\n    interceptFetchCalls(12345);\n\n    const response = await (await global.fetch('http://someurl.com')).json();\n\n    expect(response).toEqual({ data: 'abc123' });\n    expect(global.XMLHttpRequest().open).toBeCalledWith('POST', 'http://localhost:12345/requests');\n    expect(global.XMLHttpRequest().setRequestHeader).toBeCalledWith('Content-Type', 'application/json');\n    expect(global.XMLHttpRequest().send).toMatchSnapshot();\n  });\n\n  it('should intercept a url with custom options', async () => {\n    const headers = { some: 'header' };\n    const options = {\n      method: 'GET',\n      headers,\n    };\n\n    fetchMock.get('http://someurl.com', { data: 'abc123' }, { headers });\n    interceptFetchCalls(12345);\n\n    const response = await (await global.fetch('http://someurl.com', options)).json();\n\n    expect(response).toEqual({ data: 'abc123' });\n    expect(global.XMLHttpRequest().open).toBeCalledWith('POST', 'http://localhost:12345/requests');\n    expect(global.XMLHttpRequest().setRequestHeader).toBeCalledWith('Content-Type', 'application/json');\n    expect(global.XMLHttpRequest().send).toMatchSnapshot();\n  });\n\n  it('should intercept a POST fetch with a json body', async () => {\n    const body = { some: 'request body' };\n    const headers = { some: 'header' };\n    const interceptedCalls = [];\n\n    fetchMock.post('http://someurl.com', { data: 'abc123' }, { headers, body });\n    interceptFetchCalls(12345, request => interceptedCalls.push(request));\n\n    const options = {\n      method: 'POST',\n      headers,\n      body,\n    };\n\n    const response = await (await global.fetch('http://someurl.com', options)).json();\n\n    expect(response).toEqual({ data: 'abc123' });\n    expect(global.XMLHttpRequest().open).toBeCalledWith('POST', 'http://localhost:12345/requests');\n    expect(global.XMLHttpRequest().setRequestHeader).toBeCalledWith('Content-Type', 'application/json');\n    expect(global.XMLHttpRequest().send).toMatchSnapshot();\n\n    expect(interceptedCalls.length).toBe(1);\n    expect(interceptedCalls[0]).toEqual({\n      request: {\n        url: 'http://someurl.com',\n        headers: { some: 'header' },\n        method: 'POST',\n        content: { some: 'request body' },\n      },\n      response: {\n        headers: undefined,\n        statusCode: 200,\n        content: { data: 'abc123' },\n      },\n    });\n  });\n\n  it('should log an error to the console when there is a problem submitting request data', async () => {\n    fetchMock.get('http://someurl.com', { data: 'abc123' });\n    interceptFetchCalls(12345);\n    global.XMLHttpRequest().open.mockImplementation(() => { throw new Error(); });\n    global.console = { error: jest.fn() };\n\n    const response = await (await global.fetch('http://someurl.com')).json();\n\n    expect(response).toEqual({ data: 'abc123' });\n    expect(global.console.error.mock.calls).toMatchSnapshot();\n    expect(global.XMLHttpRequest().send.mock.calls).toEqual([]);\n  });\n});\n"]}