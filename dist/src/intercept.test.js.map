{"version":3,"sources":["../../src/intercept.test.js"],"names":["jest","mock","fn","describe","callback","beforeEach","restore","clearAllMocks","it","get","data","global","fetch","json","response","expect","toEqual","calls","toMatchSnapshot","toHaveBeenCalled","headers","some","options","method","body","interceptedCalls","post","push","request","length","toBe","url","content","undefined","statusCode","mockImplementation","Error","console","error","not"],"mappings":"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","file":"intercept.test.js","sourcesContent":["import fetchMock from 'fetch-mock';\nimport interceptFetchCalls from './intercept';\nimport submitRequest from './submitRequest';\n\njest.mock('./submitRequest', () => jest.fn());\n\ndescribe('intercept', () => {\n  const callback = jest.fn();\n\n  beforeEach(() => {\n    fetchMock.restore();\n    jest.clearAllMocks();\n  });\n\n  it('should intercept a plain url', async () => {\n    fetchMock.get('http://someurl.com', { data: 'abc123' });\n    interceptFetchCalls(12345, callback);\n\n    const response = await (await global.fetch('http://someurl.com')).json();\n\n    expect(response).toEqual({ data: 'abc123' });\n    expect(submitRequest.mock.calls).toMatchSnapshot();\n    expect(callback).toHaveBeenCalled();\n  });\n\n  it('should intercept a url with custom options', async () => {\n    const headers = { some: 'header' };\n    const options = {\n      method: 'GET',\n      headers,\n    };\n\n    fetchMock.get('http://someurl.com', { data: 'abc123' }, { headers });\n    interceptFetchCalls(12345, callback);\n\n    const response = await (await global.fetch('http://someurl.com', options)).json();\n\n    expect(response).toEqual({ data: 'abc123' });\n    expect(submitRequest.mock.calls).toMatchSnapshot();\n    expect(callback).toHaveBeenCalled();\n  });\n\n  it('should intercept a POST fetch with a json body', async () => {\n    const body = { some: 'request body' };\n    const headers = { some: 'header' };\n    const interceptedCalls = [];\n\n    fetchMock.post('http://someurl.com', { data: 'abc123' }, { headers, body });\n    interceptFetchCalls(12345, request => interceptedCalls.push(request));\n\n    const options = {\n      method: 'POST',\n      headers,\n      body,\n    };\n\n    const response = await (await global.fetch('http://someurl.com', options)).json();\n\n    expect(response).toEqual({ data: 'abc123' });\n    expect(submitRequest.mock.calls).toMatchSnapshot();\n\n    expect(interceptedCalls.length).toBe(1);\n    expect(interceptedCalls[0]).toEqual({\n      request: {\n        url: 'http://someurl.com',\n        headers: { some: 'header' },\n        method: 'POST',\n        content: { some: 'request body' },\n      },\n      response: {\n        headers: undefined,\n        statusCode: 200,\n        content: { data: 'abc123' },\n      },\n    });\n  });\n\n  it('should log an error to the console when there is a problem submitting request data', async () => {\n    fetchMock.get('http://someurl.com', { data: 'abc123' });\n    interceptFetchCalls(12345);\n    submitRequest.mockImplementation(() => { throw new Error(); });\n    global.console = { error: jest.fn() };\n\n    const response = await (await global.fetch('http://someurl.com')).json();\n\n    expect(response).toEqual({ data: 'abc123' });\n    expect(global.console.error.mock.calls).toMatchSnapshot();\n    expect(callback).not.toHaveBeenCalled();\n  });\n});\n"]}