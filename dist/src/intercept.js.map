{"version":3,"sources":["../../src/intercept.js"],"names":["port","callback","originalfetch","global","fetch","interceptFetch","fetchParams","url","config","apply","arguments","then","data","clone","response","json","catch","body","responseBody","builtRequest","headers","map"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;;;;;kBAEe,UAACA,IAAD,EAAOC,QAAP,EAAoB;AACjC,MAAMC,gBAAgBC,OAAOC,KAA7B;AACAD,SAAOC,KAAP,GAAe,SAASC,cAAT,GAAwC;AAAA;;AAAA,sCAAbC,WAAa;AAAbA,iBAAa;AAAA;;AAAA,gCAC7B,sCAAsBA,WAAtB,CAD6B;AAAA,QAC7CC,GAD6C,yBAC7CA,GAD6C;AAAA,QACxCC,MADwC,yBACxCA,MADwC;;AAGrD,WAAON,cAAcO,KAAd,CAAoB,IAApB,EAA0BC,SAA1B,EAAqCC,IAArC;AAAA,yEAA0C,iBAAOC,IAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBACxBA,KAAKC,KAAL,EADwB;;AAAA;AACzCC,wBADyC;AAAA;AAAA,uBAIpBA,SAASC,IAAT,GACxBC,KADwB,CAClB;AAAA,yBAAMF,SAASG,IAAf;AAAA,iBADkB,EAExBN,IAFwB,CAEnB;AAAA,yBAAQM,IAAR;AAAA,iBAFmB,CAJoB;;AAAA;AAIzCC,4BAJyC;AAQzCC,4BARyC,GAQ1B,8BAAaZ,GAAb,EAAkBC,MAAlB,EAA0BI,IAA1B,EAAgCM,YAAhC,CAR0B;;AAU/C;;AACA,oBAAIC,aAAaL,QAAb,CAAsBM,OAA1B,EAAmC;AACjCD,+BAAaL,QAAb,CAAsBM,OAAtB,GAAgCD,aAAaL,QAAb,CAAsBM,OAAtB,CAA8BC,GAA9D;AACD;;AAb8C;AAAA,uBAezC,6BAAkBF,YAAlB,EAAgCnB,IAAhC,CAfyC;;AAAA;;AAiB/C,oBAAIC,QAAJ,EAAcA,SAASkB,YAAT;;AAjBiC,iDAmBxCP,IAnBwC;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAA1C;;AAAA;AAAA;AAAA;AAAA,QAAP;AAqBD,GAxBD;AAyBD,C","file":"intercept.js","sourcesContent":["import extractFetchArguments from './fetchArgumentExtractor';\nimport submitRequestData from './submitRequest';\nimport buildRequest from './requestBuilder';\n\nexport default (port, callback) => {\n  const originalfetch = global.fetch;\n  global.fetch = function interceptFetch(...fetchParams) {\n    const { url, config } = extractFetchArguments(fetchParams);\n\n    return originalfetch.apply(this, arguments).then(async (data) => { // eslint-disable-line prefer-rest-params\n      const response = await data.clone();\n\n      // This ensures that non-json and null payload can be intercepted.\n      const responseBody = await response.json()\n        .catch(() => response.body)\n        .then(body => body);\n\n      const builtRequest = buildRequest(url, config, data, responseBody);\n\n      // Fetch stores the headers in a map. We need to reset it to the inner map structure to get the right value\n      if (builtRequest.response.headers) {\n        builtRequest.response.headers = builtRequest.response.headers.map;\n      }\n\n      await submitRequestData(builtRequest, port);\n\n      if (callback) callback(builtRequest);\n\n      return data;\n    });\n  };\n};\n"]}