{"version":3,"sources":["../../src/intercept.js"],"names":["port","callback","originalfetch","global","fetch","interceptFetch","fetchParams","url","config","apply","arguments","then","data","clone","json","responseBody","builtRequest","response","headers","map"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;;;;;kBAEe,UAACA,IAAD,EAAOC,QAAP,EAAoB;AACjC,MAAMC,gBAAgBC,OAAOC,KAA7B;AACAD,SAAOC,KAAP,GAAe,SAASC,cAAT,GAAwC;AAAA;;AAAA,sCAAbC,WAAa;AAAbA,iBAAa;AAAA;;AAAA,gCAC7B,sCAAsBA,WAAtB,CAD6B;AAAA,QAC7CC,GAD6C,yBAC7CA,GAD6C;AAAA,QACxCC,MADwC,yBACxCA,MADwC;;AAGrD,WAAON,cAAcO,KAAd,CAAoB,IAApB,EAA0BC,SAA1B,EAAqCC,IAArC;AAAA,yEAA0C,iBAAOC,IAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBACpBA,KAAKC,KAAL,GAAaC,IAAb,EADoB;;AAAA;AACzCC,4BADyC;AAEzCC,4BAFyC,GAE1B,8BAAaT,GAAb,EAAkBC,MAAlB,EAA0BI,IAA1B,EAAgCG,YAAhC,CAF0B;;AAI/C;;AACA,oBAAIC,aAAaC,QAAb,CAAsBC,OAA1B,EAAmC;AACjCF,+BAAaC,QAAb,CAAsBC,OAAtB,GAAgCF,aAAaC,QAAb,CAAsBC,OAAtB,CAA8BC,GAA9D;AACD;;AAP8C;AAAA,uBASzC,6BAAkBH,YAAlB,EAAgChB,IAAhC,CATyC;;AAAA;;AAW/C,oBAAIC,QAAJ,EAAcA,SAASe,YAAT;;AAXiC,iDAaxCJ,IAbwC;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAA1C;;AAAA;AAAA;AAAA;AAAA,QAAP;AAeD,GAlBD;AAmBD,C","file":"intercept.js","sourcesContent":["import extractFetchArguments from './fetchArgumentExtractor';\nimport submitRequestData from './submitRequest';\nimport buildRequest from './requestBuilder';\n\nexport default (port, callback) => {\n  const originalfetch = global.fetch;\n  global.fetch = function interceptFetch(...fetchParams) {\n    const { url, config } = extractFetchArguments(fetchParams);\n\n    return originalfetch.apply(this, arguments).then(async (data) => { // eslint-disable-line prefer-rest-params\n      const responseBody = await data.clone().json();\n      const builtRequest = buildRequest(url, config, data, responseBody);\n\n      // Fetch stores the headers in a map. We need to reset it to the inner map structure to get the right value\n      if (builtRequest.response.headers) {\n        builtRequest.response.headers = builtRequest.response.headers.map;\n      }\n\n      await submitRequestData(builtRequest, port);\n\n      if (callback) callback(builtRequest);\n\n      return data;\n    });\n  };\n};\n"]}